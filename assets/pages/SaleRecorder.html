<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Tracker</title>
  <!-- React CDN -->
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js">
  </script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.21.2/babel.min.js"></script>
  <!-- Pico CSS (light) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
  <style>
    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }
    .suggestion-container {
  position: relative;
}

.suggestion-list {
  position: absolute;
  z-index: 100;
  width: 100%;
  max-height: 150px; /* Show about 5 items with scroll */
  overflow-y: auto;
  background: var(--card-background-color);
  border: 1px solid var(--card-border-color);
  border-radius: 0 0 var(--border-radius) var(--border-radius);
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  margin-top: -1px; /* Align with input border */
}

.suggestion-item {
  cursor: pointer;
  padding: 0.5rem;
  border-bottom: 1px solid var(--card-border-color);
}

.suggestion-item:hover {
  background: var(--card-sectionning-background-color);
}

.suggestion-item:last-child {
  border-bottom: none;
}

    /* Custom styles */
    .container {
      padding: 1rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .title {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .view-buttons {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1rem;
    }
    
    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .search-container {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      align-items: center;
    }
    
    .suggestion-item {
      cursor: pointer;
      padding: 0.25rem 0.5rem;
      background: var(--card-background-color);
      border: 1px solid var(--card-border-color);
      margin-top: 0.25rem;
    }
    
    .suggestion-item:hover {
      background: var(--card-sectionning-background-color);
    }
    
    table {
      width: 100%;
      margin-top: 1rem;
    }
    
    th {
      cursor: pointer;
      white-space: nowrap;
    }
    
    .empty-state {
      text-align: center;
      padding: 2rem;
      color: var(--muted-color);
    }
    
    .actions-cell {
      white-space: nowrap;
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const App = () => {
      const [view, setView] = useState('input'); // 'input' or 'view'
      const [records, setRecords] = useState([]);
      const [editingId, setEditingId] = useState(null);
      const [searchTerm, setSearchTerm] = useState('');
      const [sortConfig, setSortConfig] = useState({ key: null, direction: 'asc' });
      const [showArchived, setShowArchived] = useState(false);

      const [formData, setFormData] = useState({
        id: Date.now(),
        buyerName: '',
        productName: '',
        link: '',
        agreedPrice: '',
        size: '',
        isPaymentMade: false,
        isProductPurchased: false,
        purchaseDate: '',
      });

      // Load data from localStorage on component mount
      useEffect(() => {
        const storedRecords = localStorage.getItem('productRecords');
        if (storedRecords) {
          setRecords(JSON.parse(storedRecords));
        }
      }, []);

      // Save data to localStorage whenever records change
      useEffect(() => {
        localStorage.setItem('productRecords', JSON.stringify(records));
      }, [records]);

      const handleInputChange = (e) => {
        const { name, value, type, checked } = e.target;
        setFormData({
          ...formData,
          [name]: type === 'checkbox' ? checked : value
        });
      };

      const handleSubmit = (e) => {
        e.preventDefault();
        const currentDate = new Date().toISOString().split('T')[0];
        const updatedFormData = {
          ...formData,
          purchaseDate: formData.purchaseDate || currentDate
        };
        if (editingId !== null) {
          setRecords(records.map(record =>
            record.id === editingId ? { ...updatedFormData } : record
          ));
          setEditingId(null);
        } else {
          setRecords([...records, { ...updatedFormData, id: Date.now() }]);
        }
        setFormData({
          id: Date.now(),
          buyerName: '',
          productName: '',
          link: '',
          agreedPrice: '',
          size: '',
          isPaymentMade: false,
          isProductPurchased: false,
          purchaseDate: '',
        });
      };

      const handleEdit = (record) => {
        setFormData({ ...record });
        setEditingId(record.id);
        setView('input');
      };

      const handleDelete = (id) => {
        if (confirm('Are you sure you want to delete this record?')) {
          setRecords(records.filter(record => record.id !== id));
        }
      };

      const requestSort = (key) => {
        let direction = 'asc';
        if (sortConfig.key === key && sortConfig.direction === 'asc') {
          direction = 'desc';
        }
        setSortConfig({ key, direction });
      };

      const sortedRecords = () => {
        let sortableRecords = [...records];
        if (sortConfig.key) {
          sortableRecords.sort((a, b) => {
            if (a[sortConfig.key] < b[sortConfig.key]) {
              return sortConfig.direction === 'asc' ? -1 : 1;
            }
            if (a[sortConfig.key] > b[sortConfig.key]) {
              return sortConfig.direction === 'asc' ? 1 : -1;
            }
            return 0;
          });
        }
        return sortableRecords;
      };

      const filteredRecords = sortedRecords().filter(record => {
        return (
          record.buyerName.toLowerCase().includes(searchTerm.toLowerCase()) ||
          record.productName.toLowerCase().includes(searchTerm.toLowerCase())
        );
      });

      const displayedRecords = filteredRecords.filter(r => showArchived || !r.archived);

      const getSortIcon = (key) => {
        if (sortConfig.key !== key) return '⇅';
        return sortConfig.direction === 'asc' ? '↑' : '↓';
      };

      const getFrequencyMap = (key) => {
        const map = {};
        records.forEach(record => {
          const value = record[key];
          if (value) {
            map[value] = (map[value] || 0) + 1;
          }
        });
        return Object.entries(map)
          .sort((a, b) => b[1] - a[1]) // sort by frequency
          .map(([value]) => value)
          .slice(0, 20); // max 20 suggestions
      };
      
      return (
        <div className="container">
          <h1 className="title">Product Tracker</h1>

          <div className="view-buttons">
            <button
              className={view === 'input' ? 'active' : 'secondary'}
              onClick={() => setView('input')}
            >
              Input Mode
            </button>
            <button
              className={view === 'view' ? 'active' : 'secondary'}
              onClick={() => setView('view')}
            >
              View Records ({records.length})
            </button>
          </div>

          {view === 'input' && (
            <div className="card fade-in">
              <h2>{editingId ? 'Edit Record' : 'Add New Record'}</h2>
              <form onSubmit={handleSubmit}>
                <div className="form-grid">
<div className="suggestion-container">
  <label htmlFor="buyerName">Buyer Name *</label>
  <input
    type="text"
    id="buyerName"
    name="buyerName"
    value={formData.buyerName}
    onChange={handleInputChange}
    required
    autoComplete="off"
  />
  {formData.buyerName && (
    <div className="suggestion-list">
      {getFrequencyMap('buyerName')
        .filter(name => 
          name.toLowerCase().startsWith(formData.buyerName.toLowerCase()) && 
          name !== formData.buyerName
        )
        .slice(0, 20) // Max 20 items
        .map((name, index) => (
          <div
            key={index}
            onClick={() => {
              setFormData({ ...formData, buyerName: name });
              // Optional: focus next field after selection
              document.getElementById('productName')?.focus();
            }}
            className="suggestion-item"
          >
            {name}
          </div>
        ))}
    </div>
  )}
</div>
<div className="suggestion-container">
  <label htmlFor="productName">Product Name *</label>
  <input
    type="text"
    id="productName"
    name="productName"
    value={formData.productName}
    onChange={handleInputChange}
    required
    autoComplete="off"
  />
  {formData.productName && (
    <div className="suggestion-list">
      {getFrequencyMap('productName')
        .filter(product => 
          product.toLowerCase().startsWith(formData.productName.toLowerCase()) && 
          product !== formData.productName
        )
        .slice(0, 20)
        .map((product, index) => (
          <div
            key={index}
            onClick={() => {
              setFormData({ ...formData, productName: product });
              document.getElementById('link')?.focus();
            }}
            className="suggestion-item"
          >
            {product}
          </div>
        ))}
    </div>
  )}
</div>
                  <div>
                    <label htmlFor="link">Link (Optional)</label>
                    <input
                      type="text"
                      id="link"
                      name="link"
                      value={formData.link}
                      onChange={handleInputChange}
                    />
                  </div>

<div className="suggestion-container">
  <label htmlFor="agreedPrice">Agreed Price *</label>
  <input
    type="number"
    id="agreedPrice"
    name="agreedPrice"
    value={formData.agreedPrice}
    onChange={handleInputChange}
    required
    step="1"
    autoComplete="off"
  />
  {formData.agreedPrice && (
    <div className="suggestion-list">
      {getFrequencyMap('agreedPrice')
        .filter(price => 
          price.startsWith(formData.agreedPrice) && 
          price !== formData.agreedPrice
        )
        .slice(0, 20)
        .map((price, index) => (
          <div
            key={index}
            onClick={() => {
              setFormData({ ...formData, agreedPrice: price });
              document.getElementById('size')?.focus();
            }}
            className="suggestion-item"
          >
            {price}
          </div>
        ))}
    </div>
  )}
</div>

                  <div>
                    <label htmlFor="size">Size *</label>
                    <input
                      type="text"
                      id="size"
                      name="size"
                      value={formData.size}
                      onChange={handleInputChange}
                      required
                    />
                  </div>

                  <div>
                    <label htmlFor="purchaseDate">Purchase Date (Optional)</label>
                    <input
                      type="date"
                      id="purchaseDate"
                      name="purchaseDate"
                      value={formData.purchaseDate}
                      onChange={handleInputChange}
                    />
                  </div>

                  <div>
                    <label>
                      <input
                        type="checkbox"
                        name="isPaymentMade"
                        checked={formData.isPaymentMade}
                        onChange={handleInputChange}
                        role="switch"
                      />
                      Payment Made
                    </label>
                  </div>

                  <div>
                    <label>
                      <input
                        type="checkbox"
                        name="isProductPurchased"
                        checked={formData.isProductPurchased}
                        onChange={handleInputChange}
                        role="switch"
                      />
                      Product Purchased
                    </label>
                  </div>
                </div>

                <div className="form-actions">
                  {editingId && (
                    <button
                      type="button"
                      onClick={() => {
                        setEditingId(null);
                        setFormData({
                          id: Date.now(),
                          buyerName: '',
                          productName: '',
                          link: '',
                          agreedPrice: '',
                          size: '',
                          isPaymentMade: false,
                          isProductPurchased: false,
                          purchaseDate: '',
                        });
                      }}
                      className="secondary"
                    >
                      Cancel
                    </button>
                  )}
                  <button
                    type="submit"
                  >
                    {editingId ? 'Update Record' : 'Save Record'}
                  </button>
                </div>
              </form>
            </div>
          )}

          {view === 'view' && (
            <div className="card fade-in">
              <div className="search-container">
                <input
                  type="text"
                  placeholder="Search by buyer or product name..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                />
                <button
                  onClick={() => setShowArchived(!showArchived)}
                  className="secondary"
                >
                  {showArchived ? 'Hide Archived' : 'Show Archived'}
                </button>
              </div>

              {records.length === 0 ? (
                <div className="empty-state">
                  无记录
                </div>
              ) : (
                <div className="table-responsive">
                  <table>
                    <thead>
                      <tr>
                        <th onClick={() => requestSort('buyerName')}>
                          买家 {getSortIcon('buyerName')}
                        </th>
                        <th onClick={() => requestSort('productName')}>
                          产品 {getSortIcon('productName')}
                        </th>
                        <th onClick={() => requestSort('agreedPrice')}>
                          价格 {getSortIcon('agreedPrice')}
                        </th>
                        <th>
                          尺码
                        </th>
                        <th onClick={() => requestSort('isPaymentMade')}>
                          已付款 {getSortIcon('isPaymentMade')}
                        </th>
                        <th onClick={() => requestSort('isProductPurchased')}>
                          已买货 {getSortIcon('isProductPurchased')}
                        </th>
                        <th>
                          隐藏
                        </th>
                        <th onClick={() => requestSort('purchaseDate')}>
                          Date {getSortIcon('purchaseDate')}
                        </th>
                        <th>
                          Actions
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      {displayedRecords.map((record) => (
                        <tr key={record.id}>
                          <td>{record.buyerName}</td>
                          <td>
                            {record.link ? (
                              <a href={record.link} target="_blank" rel="noopener noreferrer">
                                {record.productName}
                              </a>
                            ) : record.productName}
                          </td>
                          <td>${parseFloat(record.agreedPrice).toFixed(2)}</td>
                          <td>{record.size}</td>
                          <td>
                            <input
                              type="checkbox"
                              checked={record.isPaymentMade}
                              onChange={() => {
                                const updated = records.map(r =>
                                  r.id === record.id ? { ...r, isPaymentMade: !r.isPaymentMade } : r
                                );
                                setRecords(updated);
                              }}
                            />
                          </td>

                          <td>
                            <input
                              type="checkbox"
                              checked={record.isProductPurchased}
                              onChange={() => {
                                const updated = records.map(r =>
                                  r.id === record.id ? { ...r, isProductPurchased: !r.isProductPurchased } : r
                                );
                                setRecords(updated);
                              }}
                            />
                          </td>

                          <td>
                            <input
                              type="checkbox"
                              checked={record.archived || false}
                              onChange={() => {
                                const updated = records.map(r =>
                                  r.id === record.id ? { ...r, archived: !r.archived } : r
                                );
                                setRecords(updated);
                              }}
                            />
                          </td>
                          <td>{record.purchaseDate || '-'}</td>
                          <td className="actions-cell">
                            <button
                              onClick={() => handleEdit(record)}
                              className="secondary"
                            >
                              ✏️
                            </button>
                            <button
                              onClick={() => handleDelete(record.id)}
                              className="secondary"
                            >
                              🗑️
                            </button>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              )}
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>

</html>
